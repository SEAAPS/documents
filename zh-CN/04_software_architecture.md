# 软件系统架构 !heading

区块链和金融业务实际结合，在软件架构层面和传统的中心化系统不一样，本章节不仅通过架构来说明，针对不同场景应用，也有设计说明。

## 软件架构

金融应用的软件架构如下图：

![local image](../Images/03_software_architecture.png)

作为应用，例如(eWallet)，是通过集成SDK获得访问区块链服务的能力。在API以下区域，可以视为一个区块链节点服务，整个区块链网络中有很多这样的节点，应用可以选择任意一个节点，都可以运行。

区块链的设计是围绕账本可信的目的展开的，因此对交易的统计归类以及查询来说，区块链的API是低效的，通常情况下这个职责由浏览器服务来担任。

## 支付

作为银行来说，使用区块链进行支付，需要将真实的资金和区块链上流通的通证进行映射，业务框架图如下：

![local image](../Images/04_payment_flow.png)

1. 用户（公司）注册区块链钱包，并在银行完成KYC，和用户在银行的账户进行绑定
1. 用户（公司）充值货币到银行，
1. 银行收到后，将用户银行账户的相应资金转移到托管的资金池账户
1. 银行接着将DC转移到用户的钱包中
1. 用户自己可以直接将DC支付给另外一个用户钱包
1. 用户B需要提现成货币到自己银行账户的话，在区块链上发起提现流程，将资金转移到银行的钱包中(Fingate)
1. 银行监视到资金变化后，根据交易请求，将资金池里面的资金划拨到用户B的银行账户中
1. 在区块链上的支付活动受到监管节点的监视，满足反洗钱（AML）的监管要求，因为每个钱包都是做了KYC的。

图中的资金池的资金是在区块链上流通的资产通证的总和，两边的数量完全一致。

## 汇兑

对于汇兑业务，基于区块链的流程如下：

![local image](../Images/05_remittance_without_swift_flow.png)

对于会使用手机APP的用户来说，接收到通证后，直接用APP进行支付，或者在将通证通过银行银关提现到自己的银行账户。

对于没有银行账户的用户来说，汇款人可以用双重加密方式进行汇款。

1. 汇款人将通证转账到离接收人最近的取款点钱包中，备注用取款点钱包地址加上汇款人指定的密码进行双重加密；
1. 汇款人将密码通过短信、电话等其他方式告知接收人；
1. 接收人到取款点，告知密码，取款点用只有自己知道的钱包密钥和密码进行解密，得到备注明文信息，核对接收人身份后，付款；

